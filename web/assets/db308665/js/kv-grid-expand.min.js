/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2023
 * @version   3.5.3
 *
 * jQuery methods library for yii2-grid expand row column
 *
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2023, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvExpandRow;!function(t){"use strict";var e=".kvExpandRowColumn",a=function(t){return t.hasClass("kv-state-expanded")&&!t.hasClass("kv-state-disabled")},n=function(t){return t.hasClass("kv-state-collapsed")&&!t.hasClass("kv-state-disabled")},i=function(t,e){t.length&&t.removeClass(e).addClass(e)},l=function(t){t.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},s=function(t){t.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},o=function(t,a,n,i){var l=i?a:a.split(" ").join(e+" ")+e;t.length&&t.off(l).on(l,n)};kvExpandRow=function(e,d){var r,c,v,p,h="kvRowNum_"+d,f=e.gridId,u=e.hiddenFromExport,x=e.detailUrl,g=e.onDetailLoaded,k=e.expandIcon,w=e.collapseIcon,$=e.expandTitle,m=e.collapseTitle,C=e.expandAllTitle,y=e.collapseAllTitle,A=e.expandOneOnly,b=e.enableRowClick,I=e.rowClickExcludedTags,N=e.enableCache,R=e.extraData,T=e.msgDetailLoading,E=u?e.rowCssClass+" skip-export":e.rowCssClass,K=e.animationDuration,D=t("#"+f),j="."+d,L=D.find(".kv-expand-header-cell.kv-batch-toggle"+j),O=L.find(".kv-expand-header-icon"),P=void 0!==e.collapseAll&&e.collapseAll,S=void 0!==e.expandAll&&e.expandAll,U=D.find("td.kv-expand-icon-cell"+j+" .kv-expand-row:not(.kv-state-disabled)"),F=U.length,Q="kv-expand-detail-loading",_=function(){var e=D.find("td.kv-expand-icon-cell"+j+":first"),a=e&&e.length?e.closest("tr"):"",n=0;return a&&a.length?(a.find("> td").each(function(){"none"!==t(this).css("display")&&n++}),n):0}(),q=function(t){i(t,Q)},z=function(t){if(t.length){var e=isNaN(K)?1e3:K+200;setTimeout(function(){t.removeClass(Q)},e)}},B=function(){var t=D.data(h);return t=t?parseInt(t):0,isNaN(t)?0:t},G=function(t){D.data(h,t)},H=function(){var t=B();D.data(h,t+1)},J=function(){G(U.find(".kv-state-expanded").length),l(O),O.html(w),L.attr("title",y)},M=function(){G(U.find(".kv-state-collapsed").length),s(O),O.html(k),L.attr("title",C)};(r=function(t){this.$element=t,this.init()}).prototype={constructor:r,init:function(){var t;this.$row=this.$element.closest("tr"),this.$icon=this.$element.find(">.kv-expand-icon"),this.$detail=this.$element.find(".kv-expanded-row"+j+":first"),this.$cell=this.$icon.closest(".kv-expand-icon-cell"),this.$container=this.$cell.find(".kv-expand-detail:first"),this.vKey=this.$detail.data("key"),this.vInd=this.$detail.data("index"),0===this.$detail.length&&(this.vKey=this.$row.data("key"),t=this.$row.next('tr.kv-expand-detail-row[data-key="'+this.vKey+'"]'),this.$detail=t.find(".kv-expanded-row"))},run:function(){var e=this,i=e.$row,l=e.$cell,s=e.$icon;return S?(n(s)&&e.load(function(){e.expand(!0),H(),B()>=F&&(z(L),O.focus())}),void(B()>=F&&(z(L),O.focus()))):P?(a(s)&&(e.collapse(),H(),B()>=F&&(z(L),O.focus())),void(B()>=F&&(z(L),O.focus()))):(a(s)&&(x?e.load(function(){e.expand(!1)}):e.expand(!1)),o(l,"click",function(t){s.hasClass("kv-state-disabled")||e.toggle(),t.stopPropagation()}),void o(i,"click",function(a){var n=a.target,i=t(n).length&&t(n).hasClass("kv-disable-click")||-1!==t.inArray(n.nodeName,I);b&&!i&&e.toggle()}))},load:function(e){var a=this.$cell,n=this.$detail,i=this.vKey,l=this.vInd,s=t.extend({expandRowKey:i,expandRowInd:l},R),o=!N||0===n.html().length;x.length>0&&o?t.ajax({type:"POST",data:s,url:x,beforeSend:function(){q(a),D.trigger("kvexprow:beforeLoad",[l,i,R]),n.html(T)},success:function(t){n.html(t),z(a),"function"==typeof g&&g(),e(),D.trigger("kvexprow:loaded",[l,i,R])},error:function(){n.html('<div class="alert alert-danger">Error fetching data. Please try again later.</div>'),D.trigger("kvexprow:error",[l,i,R]),z(a)}}):(z(a),"function"==typeof e&&e())},expand:function(e){var n=this.$row,i=this.$icon,l=this.$cell,o=this.$detail,d=this.vKey,r=this.vInd,c=x.length>0;if(!a(i)){c||q(l),D.find('tr[data-index="'+r+'"]').remove(),o.hide(),n.after(o);var v='<tr class="kv-expand-detail-row '+E+'" data-key="'+d+'" data-index="'+r+'">';if(o.wrap('<td colspan="'+_+'">').parent().wrap(v),i.html(w),l.attr("title",m),e?o.slideDown(K,function(){s(i),o.show()}):(o.show(),s(i)),n.attr("data-group-key")){var p=n.prevAll("."+f),h=n.index()+1;p.push(n),t.each(p,function(e,a){var n=t(a).find("td."+f+"[rowspan]");t.each(n,function(e,n){var i=parseInt(t(n).attr("rowspan"));!isNaN(i)&&t(a).index()+i>h&&t(n).attr("rowspan",i+1)})})}c||z(l)}},collapse:function(e){var a=this.$row,i=this.$icon,s=this.$cell,o=this.$detail,d=this.$container;n(i)||(e||q(s),d.html(""),i.html(k),s.attr("title",$),o.slideUp(K,function(){var e=o.closest("tr.kv-expand-detail-row");if(e.length&&e.before(o).remove(),o.appendTo(d),l(i),a.attr("data-group-key")){var n=a.prevAll("."+f);n.push(a);var s=a.index()+1;t.each(n,function(e,a){var n=t(a).find("td."+f+"[rowspan]");t.each(n,function(e,n){var i=parseInt(t(n).attr("rowspan"));!isNaN(i)&&t(a).index()+i>s&&t(n).attr("rowspan",i-1)})})}}),e||z(s))},toggle:function(){var e,i=this,l=i.$icon,s=i.$cell,o=!1,d=i.vKey,c=i.vInd;if(!s.hasClass(Q))return n(l)?((e=A&&!P)&&(U.each(function(){new r(t(this)).collapse(!0)}),o=!0),i.load(function(){i.expand(!0)}),void(e&&!o||(D.trigger("kvexprow:toggle",[c,d,R,!0]),l.focus()))):void(a(l)&&(i.collapse(),D.trigger("kvexprow:toggle",[c,d,R,!1]),l.focus()))}},c=0,v=0,p=U.length,D.data(h)||G(0),0===R.length&&(R={}),0!==p?(U.each(function(){var e=t(this),a=new r(e),n=e.find(">.kv-expand-icon");n.hasClass("kv-state-init-expanded")?(a.expand(!1),c++):n.hasClass("kv-state-init-collapsed")&&(a.collapse(!1),v++),n.removeClass("kv-state-init-expanded kv-state-init-collapsed"),a.run()}),L.length&&(p===c?J():p===v&&M(),o(L,"click",function(){if(!L.hasClass(Q)&&0!==U.length){var i=n(O),l=a(O),s=t.extend(!0,{},e,{expandAll:l,collapseAll:i});q(L),l?(J(),D.trigger("kvexprow:toggleAll",[R,!1])):i&&(M(),D.trigger("kvexprow:toggleAll",[R,!0])),kvExpandRow(s,d)}}))):i(L,"kv-state-disabled")}}(window.jQuery);