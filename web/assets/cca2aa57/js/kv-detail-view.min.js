/*!
 * @package   yii2-detail-view
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2022
 * @version   1.8.7
 *
 * Client extension for the yii2-detail-view extension
 *
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2022, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
!function(e){"use strict";var t;t={click:"click.kvDetailView",afterValidate:"afterValidate.kvDetailView"};var i=function(t,i){var n=this;n.$element=e(t),e.each(i,function(e,t){n[e]=t}),n.init()};i.prototype={constructor:i,init:function(){this.initElements(),this.listen()},alert:function(e,t){var i;return i=this.alertMessageSettings[e].join(" "),t&&i?this.alertTemplate.replace("{content}",t).replace("{class}",i):""},initAlert:function(){var i=this.$element.find(".kv-alert-container"),n=t.click;i.find(".alert .close").each(function(){e(this).off(n).on(n,function(){setTimeout(function(){i.find(".alert").length||i.hide()},300)})})},destroy:function(){var e=t.click,i=t.afterValidate;this.$btnSave.off(e),this.$btnUpdate.off(e),this.$btnView.off(e),this.$btnDelete.off(e),this.$element.find(".kv-detail-view").closest("form").off(i),this.$element.find(".kv-alert-container .alert .close").off(e)},listen:function(){var i=this,n=i.$element.find(".kv-alert-container"),a=t.click,o=t.afterValidate,l=i.$element.find(".kv-detail-view");l.closest("form").off(o).on(o,function(e,t){void 0!==t&&l.removeClass("kv-detail-loading")}),i.$btnSave.off(a).on(a,function(){n.hide(),l.removeClass("kv-detail-loading").addClass("kv-detail-loading")}),i.$btnUpdate.off(a).on(a,function(){i.setMode("edit")}),i.$btnView.off(a).on(a,function(){i.setMode("view")}),i.$btnDelete.off(a).on(a,function(t){var n,a=e(this),o=i.deleteConfirm;t.preventDefault(),o&&("function"!=typeof(n=window[i.dialogLib]).confirm&&confirm(o)?i.execDelete(a):n.confirm(o,function(e){e&&i.execDelete(a)}))}),i.initAlert()},execDelete:function(t){var i=this,n=i.$element,a=n.find(".kv-alert-container"),o=i.deleteParams,l=i.deleteAjaxSettings||{},s=n.find(".kv-detail-view");l=e.extend({type:"post",dataType:"json",data:o,url:t.attr("href"),beforeSend:function(){a.html("").hide(),s.removeClass("kv-detail-loading").addClass("kv-detail-loading")},success:function(t){t.success&&(s.hide(),i.$btnDelete.attr("disabled","disabled"),i.$btnUpdate.attr("disabled","disabled"),i.$btnView.attr("disabled","disabled"),i.$btnSave.attr("disabled","disabled")),e.each(t.messages,function(e,t){a.append(i.alert(e,t))}),a.hide().fadeIn("slow",function(){s.removeClass("kv-detail-loading"),i.initAlert()})},error:function(t,n,o){var l="";i.showErrorStack&&(l=(l=t.responseText?e(t.responseText).text():"")&&l.length?"<pre>"+e.trim(l).replace(/\n\s*\n/g,"\n").replace(/</g,"&lt;")+"</pre>":""),l=i.alert("kv-detail-error",o+l),s.removeClass("kv-detail-loading"),a.html(l).hide().fadeIn("slow"),i.initAlert()}},l),e.ajax(l)},setMode:function(e){var t=this,i=t.fadeDelay;"edit"===e?(t.$attribs.fadeOut(i,function(){t.$formAttribs.fadeIn(i),t.$element.removeClass("kv-view-mode kv-edit-mode").addClass("kv-edit-mode")}),t.$buttons1.fadeOut(i,function(){t.$buttons2.fadeIn(i)})):(t.$formAttribs.fadeOut(i,function(){t.$attribs.fadeIn(i),t.$element.removeClass("kv-view-mode kv-edit-mode").addClass("kv-view-mode")}),t.$buttons2.fadeOut(i,function(){t.$buttons1.fadeIn(i)}))},initElements:function(){var e=this.$element;this.$btnUpdate=e.find(".kv-btn-update"),this.$btnDelete=e.find(".kv-btn-delete"),this.$btnView=e.find(".kv-btn-view"),this.$btnSave=e.find(".kv-btn-save"),this.$attribs=e.find(".kv-attribute"),this.$formAttribs=e.find(".kv-form-attribute"),this.$buttons1=e.find(".kv-buttons-1"),this.$buttons2=e.find(".kv-buttons-2")}},e.fn.kvDetailView=function(t){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var a=e(this),o=a.data("kvDetailView"),l="object"==typeof t&&t;o||(o=new i(this,e.extend({},e.fn.kvDetailView.defaults,l,e(this).data())),a.data("kvDetailView",o)),"string"==typeof t&&o[t].apply(o,n)})},e.fn.kvDetailView.defaults={mode:"view",fadeDelay:800,alertTemplate:"",alertMessageSettings:{},deleteParams:{},deleteAjaxSettings:{},deleteConfirm:"",showErrorStack:!1,dialogLib:""},e.fn.kvDetailView.Constructor=i}(window.jQuery);